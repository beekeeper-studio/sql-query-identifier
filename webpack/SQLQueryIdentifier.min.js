!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("SQLQueryIdentifier",[],e):"object"==typeof exports?exports.SQLQueryIdentifier=e():t.SQLQueryIdentifier=e()}(self,(function(){return(()=>{"use strict";var t={560:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DIALECTS=void 0,e.DIALECTS=["mssql","sqlite","mysql","psql","generic"]},215:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parse=void 0;const r=n(411),o={SELECT:"LISTING",INSERT:"MODIFICATION",DELETE:"MODIFICATION",UPDATE:"MODIFICATION",CREATE_DATABASE:"MODIFICATION",CREATE_TABLE:"MODIFICATION",CREATE_TRIGGER:"MODIFICATION",CREATE_FUNCTION:"MODIFICATION",DROP_DATABASE:"MODIFICATION",DROP_TABLE:"MODIFICATION",DROP_TRIGGER:"MODIFICATION",DROP_FUNCTION:"MODIFICATION",TRUNCATE:"MODIFICATION",UNKNOWN:"UNKNOWN"},i=["CREATE_TRIGGER","CREATE_FUNCTION"],s={generic:["BEGIN","CASE"],psql:["BEGIN","CASE","LOOP","IF"],mysql:["BEGIN","CASE","LOOP","IF"],mssql:["BEGIN","CASE"],sqlite:["BEGIN","CASE"]},a={start:-1,end:0};function u({input:t,prevState:e}){if(e)return{input:e.input,position:e.position,start:e.position+1,end:e.input.length-1};if(void 0===t)throw new Error("You must define either input or prevState");return{input:t,position:-1,start:0,end:t.length-1}}function l(t,e){if("keyword"===t.type)switch(t.value.toUpperCase()){case"SELECT":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"SELECT"}]},add:t=>{e.type="SELECT",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"CREATE":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"CREATE"}]},add:t=>{e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0},{preCanGoToNext:()=>!1,validation:{requireBefore:["whitespace"],acceptTokens:[{type:"keyword",value:"TABLE"},{type:"keyword",value:"DATABASE"},{type:"keyword",value:"TRIGGER"},{type:"keyword",value:"FUNCTION"}]},add:t=>{e.type=`CREATE_${t.value.toUpperCase()}`},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"DROP":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"DROP"}]},add:t=>{e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0},{preCanGoToNext:()=>!1,validation:{requireBefore:["whitespace"],acceptTokens:[{type:"keyword",value:"TABLE"},{type:"keyword",value:"DATABASE"},{type:"keyword",value:"TRIGGER"},{type:"keyword",value:"FUNCTION"}]},add:t=>{e.type=`DROP_${t.value.toUpperCase()}`},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"INSERT":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"INSERT"}]},add:t=>{e.type="INSERT",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"UPDATE":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"UPDATE"}]},add:t=>{e.type="UPDATE",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"DELETE":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"DELETE"}]},add:t=>{e.type="DELETE",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);case"TRUNCATE":return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"TRUNCATE"}]},add:t=>{e.type="TRUNCATE",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e)}if(!e.isStrict&&"unknown"===t.type)return function(t){const e=Object.assign({},a),n=[{preCanGoToNext:()=>!1,add:t=>{e.type="UNKNOWN",e.start<0&&(e.start=t.start)},postCanGoToNext:()=>!0}];return p(e,n,t)}(e);throw new Error(`Invalid statement parser "${t.value}"`)}function p(t,e,{isStrict:n,dialect:r}){let a,u,l=0,p=0;const c=t=>{u=a,a=t};return{getStatement:()=>t,addToken(d){if(t.endStatement)throw new Error("This statement has already got to the end.");if(t.type&&"semicolon"===d.type&&(!i.includes(t.type)||0===p&&t.canEnd))return void(t.endStatement=";");if("END"===d.value.toUpperCase())return p--,0===p&&(t.canEnd=!0),void c(d);if("whitespace"===d.type)return void c(d);if("psql"===r&&["OR","REPLACE"].includes(d.value.toUpperCase()))return void c(d);if("keyword"===d.type&&s[r].includes(d.value)&&"END"!==u.value)return p++,void c(d);if("mysql"===r&&"DEFINER"===d.value.toUpperCase())return t.definer=0,void c(d);if(0===t.definer&&"="===d.value)return t.definer++,void c(d);if("number"==typeof t.definer&&t.definer>0){if(1===t.definer&&"whitespace"===a.type)return t.definer++,void c(d);if(t.definer>1&&"whitespace"!==a.type)return void c(d);t.definer=!1}if(t.type)return;let T=e[l];if(T.preCanGoToNext(d)&&(l++,T=e[l]),T.validation&&T.validation.requireBefore&&!T.validation.requireBefore.includes(a.type)){const t=T.validation.requireBefore.join(" or ");throw new Error(`Expected any of these tokens ${t} before "${d.value}" (currentStep=${l}).`)}if(!((t,e)=>!t.validation||t.validation.acceptTokens.filter((t=>{const n=e.type===t.type,r=!t.value||e.value.toUpperCase()===t.value;return n&&r})).length>0)(T,d)&&n){const t=T.validation?T.validation.acceptTokens.map((t=>`(type="${t.type}" value="${t.value}")`)).join(" or "):"()";throw new Error(`Expected any of these tokens ${t} instead of type="${d.type}" value="${d.value}" (currentStep=${l}).`)}T.add(d),t.executionType=t.type&&o[t.type]?o[t.type]:"UNKNOWN",T.postCanGoToNext(d)&&l++,c(d)}}}e.parse=function(t,e=!0,n="generic"){const o=u({input:t}),i={type:"QUERY",start:0,end:t.length-1,body:[],tokens:[]};let s=o,a=null;const p={isCte:!1,asSeen:!1,statementEnd:!1,parens:0,state:o},c=["whitespace","comment-inline","comment-block"];for(;s.position<o.end;){const t=u({prevState:s}),o=r.scanToken(t,n);if(!a){if(c.includes(o.type)){i.tokens.push(o),s=t;continue}if("keyword"===o.type&&"WITH"===o.value){p.isCte=!0,i.tokens.push(o),p.state=t,s=t;continue}if(p.isCte&&!p.statementEnd){p.asSeen?"("===o.value?p.parens++:")"===o.value&&(p.parens--,0===p.parens&&(p.statementEnd=!0)):"AS"===o.value&&(p.asSeen=!0),i.tokens.push(o),s=t;continue}if(p.isCte&&p.statementEnd&&","===o.value){p.asSeen=!1,p.statementEnd=!1,i.tokens.push(o),s=t;continue}a=l(o,{isStrict:e,dialect:n}),p.isCte&&(a.getStatement().start=p.state.start,p.isCte=!1,p.asSeen=!1,p.statementEnd=!1)}a.addToken(o),i.tokens.push(o),s=t;const d=a.getStatement();d.endStatement&&(d.end=o.end,i.body.push(d),a=null)}if(a){const t=a.getStatement();t.endStatement||(t.end=i.end,i.body.push(t))}return i}},411:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.scanToken=void 0;const n=["SELECT","INSERT","DELETE","UPDATE","CREATE","DROP","TABLE","TRIGGER","FUNCTION","DATABASE","TRUNCATE","WITH","AS"],r={";":"semicolon"},o={'"':'"',"'":"'","`":"`","[":"]"};function i(t,e=0){return t.position+e===t.input.length-1?null:(t.position+=1+e,t.input[t.position])}function s(t){t.position!==t.start&&t.position--}function a(t){return t.position+1===t.input.length-1?null:t.input[t.position+1]}function u(t){return" "===t||"\t"===t||"\n"===t||"\r"===t}function l(t){return null!==t&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||"_"===t)}e.scanToken=function(t,e="generic"){const p=i(t);if(u(p))return function(t){let e;do{e=i(t)}while(u(e));null===e||u(e)||s(t);const n=t.input.slice(t.start,t.position+1);return{type:"whitespace",value:n,start:t.start,end:t.start+n.length-1}}(t);if(function(t,e){let n="-"===t;if(!n)return!1;const r=i(e);n="-"===r,n||s(e);return n}(p,t))return function(t){let e;do{e=i(t)}while("\n"!==e&&null!==e);null!==e&&"\n"!==e&&s(t);const n=t.input.slice(t.start,t.position+1);return{type:"comment-inline",value:n,start:t.start,end:t.start+n.length-1}}(t);if(function(t,e){let n="/"===t;if(!n)return!1;const r=i(e);n="*"===r,n||s(e);return n}(p,t))return function(t){let e,n="";do{e=n,n=i(t)}while((e||"")+(n||"")!=="*/"&&null!==n);null!==n&&"/"!==n&&s(t);const r=t.input.slice(t.start,t.position+1);return{type:"comment-block",value:r,start:t.start,end:t.start+r.length-1}}(t);if(function(t,e){return("mysql"===e?["'",'"']:["'"]).includes(t)}(p,e)&&null!==p)return function(t,e){let n;do{n=i(t),n===e&&a(t)===e&&(n=i(t,1))}while(n!==e&&null!==n);null!==n&&e!==n&&s(t);const r=t.input.slice(t.start,t.position+1);return{type:"string",value:r,start:t.start,end:t.start+r.length-1}}(t,o[p]);if(function(t){return null!==/^\$[\w]*\$/.exec(t.input.slice(t.start))}(t))return function(t){const e=/^(\$[a-zA-Z0-9_]*\$)/.exec(t.input.slice(t.start));if(!e)throw new Error("Could not find dollar quoted string opener");const n=e[1];for(let e=0;e<n.length-1;e++)i(t);let r="";for(;t.input.slice(t.position,t.position+n.length)!==n&&null!==r;){do{r=i(t)}while("$"!==r&&null!==r);"$"!==r&&null!==r&&s(t)}for(let e=0;e<n.length-1;e++)i(t);const o=t.input.slice(t.start,t.position+1);return{type:"string",value:o,start:t.start,end:t.start+o.length-1}}(t);if(function(t,e){return("mssql"===e?['"',"["]:['"',"`"]).includes(t)}(p,e)&&null!==p)return function(t,e){let n;do{n=i(t)}while(e!==n&&null!==n);null!==n&&e!==n&&s(t);const r=t.input.slice(t.start,t.position+1);return{type:"keyword",value:r,start:t.start,end:t.start+r.length-1}}(t,o[p]);if(l(p))return function(t){let e;do{e=i(t)}while(l(e));null===e||l(e)||s(t);const r=t.input.slice(t.start,t.position+1);if(o=r,!n.includes(o.toUpperCase()))return function(t,e){return{type:"unknown",value:e,start:t.start,end:t.start+e.length-1}}(t,r);var o;return{type:"keyword",value:r,start:t.start,end:t.start+r.length-1}}(t);const c=function(t){const e=t.input.slice(t.start,t.position+1),n=function(t){return r[t]}(e);if(!n)return null;return{type:n,value:e,start:t.start,end:t.start+e.length-1}}(t);return c||function(t){return{type:"unknown",value:t.input.slice(t.start,t.position+1),start:t.start,end:t.start}}(t)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}var r={};return(()=>{var t=r;Object.defineProperty(t,"__esModule",{value:!0}),t.identify=void 0;const e=n(215),o=n(560);t.identify=function(t,n={}){const r=void 0===n.strict||!0===n.strict,i=void 0===n.dialect?"generic":n.dialect;if(!o.DIALECTS.includes(i))throw new Error(`Unknown dialect. Allowed values: ${o.DIALECTS.join(",")}`);return e.parse(t,r,i).body.map((e=>({start:e.start,end:e.end,text:t.substring(e.start,e.end+1),type:e.type,executionType:e.executionType})))}})(),r})()}));