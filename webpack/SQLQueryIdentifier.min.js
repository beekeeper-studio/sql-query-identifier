!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SQLQueryIdentifier",[],t):"object"==typeof exports?exports.SQLQueryIdentifier=t():e.SQLQueryIdentifier=t()}(self,(function(){return(()=>{"use strict";var e={560:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DIALECTS=void 0,t.DIALECTS=["mssql","sqlite","mysql","psql","generic"]},215:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.EXECUTION_TYPES=void 0;const r=n(411);t.EXECUTION_TYPES={SELECT:"LISTING",INSERT:"MODIFICATION",DELETE:"MODIFICATION",UPDATE:"MODIFICATION",TRUNCATE:"MODIFICATION",CREATE_DATABASE:"MODIFICATION",CREATE_SCHEMA:"MODIFICATION",CREATE_TABLE:"MODIFICATION",CREATE_VIEW:"MODIFICATION",CREATE_TRIGGER:"MODIFICATION",CREATE_FUNCTION:"MODIFICATION",CREATE_INDEX:"MODIFICATION",DROP_DATABASE:"MODIFICATION",DROP_SCHEMA:"MODIFICATION",DROP_TABLE:"MODIFICATION",DROP_VIEW:"MODIFICATION",DROP_TRIGGER:"MODIFICATION",DROP_FUNCTION:"MODIFICATION",DROP_INDEX:"MODIFICATION",ALTER_DATABASE:"MODIFICATION",ALTER_SCHEMA:"MODIFICATION",ALTER_TABLE:"MODIFICATION",ALTER_VIEW:"MODIFICATION",ALTER_TRIGGER:"MODIFICATION",ALTER_FUNCTION:"MODIFICATION",ALTER_INDEX:"MODIFICATION",UNKNOWN:"UNKNOWN"};const o=["CREATE_TRIGGER","CREATE_FUNCTION"],a={generic:["BEGIN","CASE"],psql:["BEGIN","CASE","LOOP","IF"],mysql:["BEGIN","CASE","LOOP","IF"],mssql:["BEGIN","CASE"],sqlite:["BEGIN","CASE"]};function i({input:e,prevState:t}){if(t)return{input:t.input,position:t.position,start:t.position+1,end:t.input.length-1};if(void 0===e)throw new Error("You must define either input or prevState");return{input:e,position:-1,start:0,end:e.length-1}}function s(e,t){if("keyword"===e.type)switch(e.value.toUpperCase()){case"SELECT":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"SELECT"}]},add:e=>{t.type="SELECT",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"CREATE":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"CREATE"}]},add:e=>{t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0},{preCanGoToNext:()=>!1,validation:{requireBefore:["whitespace"],acceptTokens:[..."sqlite"!==e.dialect?[{type:"keyword",value:"DATABASE"},{type:"keyword",value:"SCHEMA"}]:[],{type:"keyword",value:"TABLE"},{type:"keyword",value:"VIEW"},{type:"keyword",value:"TRIGGER"},{type:"keyword",value:"FUNCTION"},{type:"keyword",value:"INDEX"}]},add:e=>{t.type=`CREATE_${e.value.toUpperCase()}`},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"DROP":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"DROP"}]},add:e=>{t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0},{preCanGoToNext:()=>!1,validation:{requireBefore:["whitespace"],acceptTokens:[..."sqlite"!==e.dialect?[{type:"keyword",value:"DATABASE"},{type:"keyword",value:"SCHEMA"}]:[],{type:"keyword",value:"TABLE"},{type:"keyword",value:"VIEW"},{type:"keyword",value:"TRIGGER"},{type:"keyword",value:"FUNCTION"},{type:"keyword",value:"INDEX"}]},add:e=>{t.type=`DROP_${e.value.toUpperCase()}`},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"ALTER":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"ALTER"}]},add:e=>{t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0},{preCanGoToNext:()=>!1,validation:{requireBefore:["whitespace"],acceptTokens:[..."sqlite"!==e.dialect?[{type:"keyword",value:"DATABASE"},{type:"keyword",value:"SCHEMA"},{type:"keyword",value:"TRIGGER"},{type:"keyword",value:"FUNCTION"},{type:"keyword",value:"INDEX"}]:[],{type:"keyword",value:"TABLE"},{type:"keyword",value:"VIEW"}]},add:e=>{t.type=`ALTER_${e.value.toUpperCase()}`},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"INSERT":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"INSERT"}]},add:e=>{t.type="INSERT",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"UPDATE":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"UPDATE"}]},add:e=>{t.type="UPDATE",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"DELETE":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"DELETE"}]},add:e=>{t.type="DELETE",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);case"TRUNCATE":return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,validation:{acceptTokens:[{type:"keyword",value:"TRUNCATE"}]},add:e=>{t.type="TRUNCATE",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t)}if(!t.isStrict&&"unknown"===e.type)return function(e){const t={start:-1,end:0,parameters:[]},n=[{preCanGoToNext:()=>!1,add:e=>{t.type="UNKNOWN",t.start<0&&(t.start=e.start)},postCanGoToNext:()=>!0}];return u(t,n,e)}(t);throw new Error(`Invalid statement parser "${e.value}"`)}function u(e,n,{isStrict:r,dialect:i}){let s,u,l=0,p=0;const d=e=>{u=s,s=e};return{getStatement:()=>e,addToken(c){if(e.endStatement)throw new Error("This statement has already got to the end.");if(e.type&&"semicolon"===c.type&&(!o.includes(e.type)||0===p&&e.canEnd))return void(e.endStatement=";");if("END"===c.value.toUpperCase())return p--,0===p&&(e.canEnd=!0),void d(c);if("whitespace"===c.type)return void d(c);if("keyword"===c.type&&a[i].includes(c.value)&&"END"!==u.value.toUpperCase())return p++,void d(c);if("parameter"!==c.type||"?"!==c.value&&e.parameters.includes(c.value)||e.parameters.push(c.value),e.type)return;if("UNIQUE"===c.value.toUpperCase()||"mysql"===i&&["FULLTEXT","SPATIAL"].includes(c.value.toUpperCase())||"mssql"===i&&["CLUSTERED","NONCLUSTERED"].includes(c.value.toUpperCase()))return void d(c);if(["psql","mssql"].includes(i)&&"MATERIALIZED"===c.value.toUpperCase())return void d(c);if(["psql","mysql"].includes(i)&&["OR","REPLACE"].includes(c.value.toUpperCase()))return void d(c);if(["psql","sqlite"].includes(i)&&["TEMP","TEMPORARY"].includes(c.value.toUpperCase()))return void d(c);if("mysql"===i&&"DEFINER"===c.value.toUpperCase())return e.definer=0,void d(c);if(0===e.definer&&"="===c.value)return e.definer++,void d(c);if(void 0!==e.definer&&e.definer>0){if(1===e.definer&&"whitespace"===s.type)return e.definer++,void d(c);if(e.definer>1&&"whitespace"!==s.type)return void d(c);delete e.definer}if("mysql"===i&&"ALGORITHM"===c.value.toUpperCase())return e.algorithm=0,void d(c);if(0===e.algorithm&&"="===c.value)return e.algorithm++,void d(c);if(void 0!==e.algorithm&&e.algorithm>0){if(1===e.algorithm&&"whitespace"===s.type)return e.algorithm++,void d(c);if(e.algorithm>1&&["UNDEFINED","MERGE","TEMPTABLE"].includes(s.value.toUpperCase()))return void d(c);delete e.algorithm}if("mysql"===i&&"SQL"===c.value.toUpperCase())return e.sqlSecurity=0,void d(c);if(void 0!==e.sqlSecurity){if(0===e.sqlSecurity&&"SECURITY"===c.value.toUpperCase()||1===e.sqlSecurity&&["DEFINER","INVOKER"].includes(c.value.toUpperCase()))return e.sqlSecurity++,void d(c);2===e.sqlSecurity&&delete e.sqlSecurity}let E=n[l];if(E.preCanGoToNext(c)&&(l++,E=n[l]),E.validation&&E.validation.requireBefore&&!E.validation.requireBefore.includes(s.type)){const e=E.validation.requireBefore.join(" or ");throw new Error(`Expected any of these tokens ${e} before "${c.value}" (currentStep=${l}).`)}if(!((e,t)=>!e.validation||e.validation.acceptTokens.filter((e=>{const n=t.type===e.type,r=!e.value||t.value.toUpperCase()===e.value;return n&&r})).length>0)(E,c)&&r){const e=E.validation?E.validation.acceptTokens.map((e=>`(type="${e.type}" value="${e.value}")`)).join(" or "):"()";throw new Error(`Expected any of these tokens ${e} instead of type="${c.type}" value="${c.value}" (currentStep=${l}).`)}E.add(c),e.executionType=e.type&&t.EXECUTION_TYPES[e.type]?t.EXECUTION_TYPES[e.type]:"UNKNOWN",E.postCanGoToNext(c)&&l++,d(c)}}}t.parse=function(e,t=!0,n="generic"){const o=i({input:e}),a={type:"QUERY",start:0,end:e.length-1,body:[],tokens:[]};let u=o,l=null;const p={isCte:!1,asSeen:!1,statementEnd:!1,parens:0,state:o},d=["whitespace","comment-inline","comment-block","semicolon"];for(;u.position<o.end;){const e=i({prevState:u}),o=(0,r.scanToken)(e,n);if(!l){if(d.includes(o.type)){a.tokens.push(o),u=e;continue}if("keyword"===o.type&&"WITH"===o.value.toUpperCase()){p.isCte=!0,a.tokens.push(o),p.state=e,u=e;continue}if(p.isCte&&!p.statementEnd){p.asSeen?"("===o.value?p.parens++:")"===o.value&&(p.parens--,0===p.parens&&(p.statementEnd=!0)):"AS"===o.value.toUpperCase()&&(p.asSeen=!0),a.tokens.push(o),u=e;continue}if(p.isCte&&p.statementEnd&&","===o.value){p.asSeen=!1,p.statementEnd=!1,a.tokens.push(o),u=e;continue}l=s(o,{isStrict:t,dialect:n}),p.isCte&&(l.getStatement().start=p.state.start,p.isCte=!1,p.asSeen=!1,p.statementEnd=!1)}l.addToken(o),a.tokens.push(o),u=e;const c=l.getStatement();c.endStatement&&(c.end=o.end,a.body.push(c),l=null)}if(l){const e=l.getStatement();e.endStatement||(e.end=a.end,a.body.push(e))}return a}},411:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanToken=void 0;const n=["SELECT","INSERT","DELETE","UPDATE","CREATE","DROP","DATABASE","SCHEMA","TABLE","VIEW","TRIGGER","FUNCTION","INDEX","ALTER","TRUNCATE","WITH","AS","MATERIALIZED"],r={";":"semicolon"},o={'"':'"',"'":"'","`":"`","[":"]"};function a(e,t=0){return e.position+t===e.input.length-1?null:(e.position+=1+t,e.input[e.position])}function i(e){e.position!==e.start&&e.position--}function s(e){return e.position>=e.input.length-1?null:e.input[e.position+1]}function u(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function l(e){return null!==e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e)}t.scanToken=function(e,t="generic"){const p=a(e);if(u(p))return function(e){let t;do{t=a(e)}while(u(t));null===t||u(t)||i(e);const n=e.input.slice(e.start,e.position+1);return{type:"whitespace",value:n,start:e.start,end:e.start+n.length-1}}(e);if(function(e,t){let n="-"===e;if(!n)return!1;const r=a(t);n="-"===r,n||i(t);return n}(p,e))return function(e){let t;do{t=a(e)}while("\n"!==t&&null!==t);null!==t&&"\n"!==t&&i(e);const n=e.input.slice(e.start,e.position+1);return{type:"comment-inline",value:n,start:e.start,end:e.start+n.length-1}}(e);if(function(e,t){let n="/"===e;if(!n)return!1;const r=a(t);n="*"===r,n||i(t);return n}(p,e))return function(e){let t,n="";do{t=n,n=a(e)}while((t||"")+(n||"")!=="*/"&&null!==n);null!==n&&"/"!==n&&i(e);const r=e.input.slice(e.start,e.position+1);return{type:"comment-block",value:r,start:e.start,end:e.start+r.length-1}}(e);if(function(e,t){return("mysql"===t?["'",'"']:["'"]).includes(e)}(p,t)&&null!==p)return function(e,t){let n;do{n=a(e),n===t&&s(e)===t&&(n=a(e,1))}while(n!==t&&null!==n);null!==n&&t!==n&&i(e);const r=e.input.slice(e.start,e.position+1);return{type:"string",value:r,start:e.start,end:e.start+r.length-1}}(e,o[p]);if(function(e,t,n){let r="?";if("psql"===n){r="$";const e=s(t);if(null===e||isNaN(Number(e)))return!1}"mssql"===n&&(r=":");return e===r}(p,e,t))return function(e,t){if(["mysql","generic","sqlite"].includes(t))return{type:"parameter",value:e.input.slice(e.start,e.position+1),start:e.start,end:e.start};if("psql"===t){let t;do{t=a(e)}while(!isNaN(Number(t))&&!u(t)&&null!==t);u(t)&&i(e);const n=e.input.slice(e.start,e.position+1);return{type:"parameter",value:n,start:e.start,end:e.start+n.length-1}}if("mssql"===t){let t;do{t=a(e)}while(!u(t)&&null!==t);u(t)&&i(e);const n=e.input.slice(e.start,e.position+1);return{type:"parameter",value:n,start:e.start,end:e.start+n.length-1}}return{type:"parameter",value:"unknown",start:e.start,end:e.end}}(e,t);if(function(e){return null!==/^\$[\w]*\$/.exec(e.input.slice(e.start))}(e))return function(e){const t=/^(\$[a-zA-Z0-9_]*\$)/.exec(e.input.slice(e.start));if(!t)throw new Error("Could not find dollar quoted string opener");const n=t[1];for(let t=0;t<n.length-1;t++)a(e);let r="";for(;e.input.slice(e.position,e.position+n.length)!==n&&null!==r;){do{r=a(e)}while("$"!==r&&null!==r);"$"!==r&&null!==r&&i(e)}for(let t=0;t<n.length-1;t++)a(e);const o=e.input.slice(e.start,e.position+1);return{type:"string",value:o,start:e.start,end:e.start+o.length-1}}(e);if(function(e,t){return("mssql"===t?['"',"["]:['"',"`"]).includes(e)}(p,t)&&null!==p)return function(e,t){let n;do{n=a(e)}while(t!==n&&null!==n);null!==n&&t!==n&&i(e);const r=e.input.slice(e.start,e.position+1);return{type:"keyword",value:r,start:e.start,end:e.start+r.length-1}}(e,o[p]);if(l(p))return function(e){let t;do{t=a(e)}while(l(t));null===t||l(t)||i(e);const r=e.input.slice(e.start,e.position+1);if(o=r,!n.includes(o.toUpperCase()))return function(e,t){return{type:"unknown",value:t,start:e.start,end:e.start+t.length-1}}(e,r);var o;return{type:"keyword",value:r,start:e.start,end:e.start+r.length-1}}(e);const d=function(e){const t=e.input.slice(e.start,e.position+1),n=function(e){return r[e]}(t);if(!n)return null;return{type:n,value:t,start:e.start,end:e.start+t.length-1}}(e);return d||function(e){return{type:"unknown",value:e.input.slice(e.start,e.position+1),start:e.start,end:e.start}}(e)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.getExecutionType=e.identify=void 0;const t=n(215),o=n(560);e.identify=function(e,n={}){const r=void 0===n.strict||!0===n.strict,a=void 0===n.dialect?"generic":n.dialect;if(!o.DIALECTS.includes(a))throw new Error(`Unknown dialect. Allowed values: ${o.DIALECTS.join(", ")}`);return(0,t.parse)(e,r,a).body.map((t=>({start:t.start,end:t.end,text:e.substring(t.start,t.end+1),type:t.type,executionType:t.executionType,parameters:"psql"===a?t.parameters.sort():t.parameters})))},e.getExecutionType=function(e){return t.EXECUTION_TYPES[e]||"UNKNOWN"}})(),r})()}));